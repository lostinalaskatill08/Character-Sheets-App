<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>D&D Character Sheet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="mobile-web-app-capable" content="yes" />
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React & ReactDOM -->
  <script src="https://cdn.jsdelivr.net/npm/react@17/umd/react.development.js" crossorigin></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@17/umd/react-dom.development.js" crossorigin></script>
  <!-- Babel for in-browser JSX transform -->
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel&display=swap" rel="stylesheet" />

  <style>
    body {
      font-family: 'Cinzel', serif;
      /* Aged paper background */
      background: #f4e4bc url("https://www.transparenttextures.com/patterns/aged-paper.png") repeat;
      background-blend-mode: overlay;
      color: #4a2c0f;
    }
    /* Dark mode body */
    .dark {
      background-color: #1a1a1a;
      color: #fafafa;
      background-blend-mode: normal;
    }
    /* Basic theming for container and elements */
    .sheet-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 1rem;
      background-color: #1a222e; /* Dark panel behind fields */
      border-radius: 0.5rem;
      color: #f4e4bc;
    }
    input, select, textarea {
      font-family: 'Cinzel', serif;
      color: #000000 !important;
      background-color: #f9efd4 !important;
      border-color: #4a3f35 !important;
    }
    input::placeholder, textarea::placeholder {
      color: #666666;
    }
    .btn-dnd {
      background-color: #8B0000;
      color: #f4e4bc;
      font-family: 'Cinzel', serif;
      font-weight: bold;
      border: 1px solid #4a3f35;
      transition: all 0.3s ease;
    }
    .btn-dnd:hover {
      background-color: #6d0101;
    }
    ::-webkit-scrollbar {
      width: 12px;
    }
    ::-webkit-scrollbar-track {
      background: #f5e8c7;
    }
    ::-webkit-scrollbar-thumb {
      background-color: #8b5a2b;
      border-radius: 20px;
      border: 3px solid #f5e8c7;
    }
  </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">

/** ========== LOCALSTORAGE BACKUP / RESTORE ========== */
function backupLocalStorage() {
  // We'll backup the entire localStorage. This includes the characterSheet data
  const data = { characterSheet: localStorage.getItem("characterSheet"), darkMode: localStorage.getItem("darkMode") };
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "character_sheet_backup.json";
  a.click();
  URL.revokeObjectURL(url);
}

function restoreLocalStorage(event) {
  const files = event.target.files;
  if (!files || !files.length) return;
  const file = files[0];
  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      const data = JSON.parse(e.target.result);
      // If the JSON includes "characterSheet" or "darkMode", restore them
      if (data.characterSheet !== undefined) {
        localStorage.setItem("characterSheet", data.characterSheet);
      }
      if (data.darkMode !== undefined) {
        localStorage.setItem("darkMode", data.darkMode);
      }
      alert("LocalStorage restored. Please refresh the page.");
    } catch (err) {
      console.error(err);
      alert("Failed to restore. Invalid JSON?");
    }
  };
  reader.readAsText(file);
}

/** ========== DARK MODE TOGGLE ========== */
function DarkModeToggle() {
  const [darkMode, setDarkMode] = React.useState(() => localStorage.getItem("darkMode") === "true");

  React.useEffect(() => {
    if (darkMode) document.body.classList.add("dark");
    else document.body.classList.remove("dark");
    localStorage.setItem("darkMode", darkMode);
  }, [darkMode]);

  return (
    <button className="px-3 py-1 btn-dnd rounded" onClick={() => setDarkMode(!darkMode)}>
      {darkMode ? "Light Mode" : "Dark Mode"}
    </button>
  );
}

/** ========== MAIN CHARACTER SHEET COMPONENT ========== */
function CharacterSheet() {
  // A single state object for the entire character sheet
  const [sheetData, setSheetData] = React.useState(() => {
    // Load from local storage or default
    const saved = localStorage.getItem("characterSheet");
    if (saved) return JSON.parse(saved);
    return {
      characterName: "",
      class: "",
      armor: "",
      hitPoints: "",
      proficiencyBonus: "",
      heroicInspiration: "",
      wisdom: "",
      charisma: "",
      dexterity: "",
      strength: "",
      constitution: "",
      intelligence: "",
      initiative: "",
      speed: "",
      size: "",
      passivePerception: "",
      hitDice: "",
      deathSaves: "",
      tools: "",
      weapons: "",
      armorTraining: "",
      background: "",
      languages: "",  // New field for languages
      // Skills
      animalHandling: "",
      insight: "",
      medicine: "",
      perception: "",
      survival: "",
      deception: "",
      intimidation: "",
      performance: "",
      persuasion: "",
      acrobatics: "",
      sleightOfHand: "",
      stealth: "",
      athletics: "",
      arcana: "",
      history: "",
      investigation: "",
      nature: "",
      religion: "",
      // Additional
      classLevel: "",
      shield: "",
      successes: "",
      equipment: "",
      feats: "",
      classFeatures: "",
      speciesTraits: "",
      shields: "",
      castingTime: "",
      concentrationRitual: "",
      currency: ""
    };
  });

  // Whenever sheetData changes, save to local storage
  React.useEffect(() => {
    localStorage.setItem("characterSheet", JSON.stringify(sheetData));
  }, [sheetData]);

  function handleChange(e) {
    const { name, value } = e.target;
    setSheetData((prev) => ({ ...prev, [name]: value }));
  }

  // "Copy for Prompt" - creates a text summary of the entire sheet
  function copyForPrompt() {
    const textSummary = `
D&D Character Sheet

Character Name: ${sheetData.characterName}
Class: ${sheetData.class}
Armor: ${sheetData.armor}
Hit Points: ${sheetData.hitPoints}
Proficiency Bonus: ${sheetData.proficiencyBonus}
Heroic Inspiration: ${sheetData.heroicInspiration}
Death Saves: ${sheetData.deathSaves}

STR: ${sheetData.strength}
DEX: ${sheetData.dexterity}
CON: ${sheetData.constitution}
INT: ${sheetData.intelligence}
WIS: ${sheetData.wisdom}
CHA: ${sheetData.charisma}

Initiative: ${sheetData.initiative}
Speed: ${sheetData.speed}
Size: ${sheetData.size}
Passive Perception: ${sheetData.passivePerception}
Hit Dice: ${sheetData.hitDice}

Tools: ${sheetData.tools}
Weapons: ${sheetData.weapons}
Armor Training: ${sheetData.armorTraining}
Background: ${sheetData.background}
Languages: ${sheetData.languages}

Skills:
  - Animal Handling: ${sheetData.animalHandling}
  - Insight: ${sheetData.insight}
  - Medicine: ${sheetData.medicine}
  - Perception: ${sheetData.perception}
  - Survival: ${sheetData.survival}
  - Deception: ${sheetData.deception}
  - Intimidation: ${sheetData.intimidation}
  - Performance: ${sheetData.performance}
  - Persuasion: ${sheetData.persuasion}
  - Acrobatics: ${sheetData.acrobatics}
  - Sleight of Hand: ${sheetData.sleightOfHand}
  - Stealth: ${sheetData.stealth}
  - Athletics: ${sheetData.athletics}
  - Arcana: ${sheetData.arcana}
  - History: ${sheetData.history}
  - Investigation: ${sheetData.investigation}
  - Nature: ${sheetData.nature}
  - Religion: ${sheetData.religion}

Class Level & Temp Spent: ${sheetData.classLevel}
Shield: ${sheetData.shield}
Successes: ${sheetData.successes}
Equipment, Training & Proficiencies: ${sheetData.equipment}
Feats: ${sheetData.feats}
Class Features & Weapons/Damage Cantrips: ${sheetData.classFeatures}
Species Traits: ${sheetData.speciesTraits}
Shields (Light/Medium/Heavy): ${sheetData.shields}
Casting Time: ${sheetData.castingTime}
Concentration/Ritual & Materials: ${sheetData.concentrationRitual}
Currency: ${sheetData.currency}
`.trim();

    navigator.clipboard.writeText(textSummary)
      .then(() => alert("Character sheet copied to clipboard!"))
      .catch(() => alert("Failed to copy."));
  }

  return (
    <div className="sheet-container">
      <h1 className="text-2xl font-bold mb-4 text-center text-amber-400">D&D Character Sheet</h1>
      {/* Buttons row */}
      <div className="flex flex-wrap gap-2 justify-center mb-4">
        <button className="px-3 py-1 btn-dnd rounded" onClick={copyForPrompt}>
          Copy for Prompt
        </button>
      </div>

      {/* Basic Info */}
      <div className="grid grid-cols-2 gap-4 mb-4">
        <div>
          <label className="block text-sm font-medium text-amber-400">Character Name</label>
          <input
            type="text"
            name="characterName"
            value={sheetData.characterName}
            onChange={handleChange}
            className="border p-1 rounded w-full"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Class</label>
          <input
            type="text"
            name="class"
            value={sheetData.class}
            onChange={handleChange}
            className="border p-1 rounded w-full"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Armor</label>
          <input
            type="text"
            name="armor"
            value={sheetData.armor}
            onChange={handleChange}
            className="border p-1 rounded w-full"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Hit Points</label>
          <input
            type="text"
            name="hitPoints"
            value={sheetData.hitPoints}
            onChange={handleChange}
            className="border p-1 rounded w-full"
          />
        </div>
      </div>

      {/* Row 2: Proficiency, Inspiration, Death Saves */}
      <div className="grid grid-cols-3 gap-4 mb-4">
        <div>
          <label className="block text-sm font-medium text-amber-400">Proficiency Bonus</label>
          <input
            type="text"
            name="proficiencyBonus"
            value={sheetData.proficiencyBonus}
            onChange={handleChange}
            className="border p-1 rounded w-full"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Heroic Inspiration</label>
          <input
            type="text"
            name="heroicInspiration"
            value={sheetData.heroicInspiration}
            onChange={handleChange}
            className="border p-1 rounded w-full"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Death Saves</label>
          <input
            type="text"
            name="deathSaves"
            value={sheetData.deathSaves}
            onChange={handleChange}
            className="border p-1 rounded w-full"
            placeholder="Successes/Failures"
          />
        </div>
      </div>

      {/* Ability Scores */}
      <h2 className="text-xl font-bold text-amber-400 mb-2">Ability Scores</h2>
      <div className="grid grid-cols-3 gap-4 mb-4">
        <div>
          <label className="block text-sm font-medium text-amber-400">Strength</label>
          <input
            type="text"
            name="strength"
            value={sheetData.strength}
            onChange={handleChange}
            className="border p-1 rounded w-full"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Dexterity</label>
          <input
            type="text"
            name="dexterity"
            value={sheetData.dexterity}
            onChange={handleChange}
            className="border p-1 rounded w-full"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Constitution</label>
          <input
            type="text"
            name="constitution"
            value={sheetData.constitution}
            onChange={handleChange}
            className="border p-1 rounded w-full"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Intelligence</label>
          <input
            type="text"
            name="intelligence"
            value={sheetData.intelligence}
            onChange={handleChange}
            className="border p-1 rounded w-full"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Wisdom</label>
          <input
            type="text"
            name="wisdom"
            value={sheetData.wisdom}
            onChange={handleChange}
            className="border p-1 rounded w-full"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Charisma</label>
          <input
            type="text"
            name="charisma"
            value={sheetData.charisma}
            onChange={handleChange}
            className="border p-1 rounded w-full"
          />
        </div>
      </div>

      {/* Additional Stats */}
      <h2 className="text-xl font-bold text-amber-400 mb-2">Additional Stats</h2>
      <div className="grid grid-cols-3 gap-4 mb-4">
        <div>
          <label className="block text-sm font-medium text-amber-400">Initiative</label>
          <input
            type="text"
            name="initiative"
            value={sheetData.initiative}
            onChange={handleChange}
            className="border p-1 rounded w-full"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Speed</label>
          <input
            type="text"
            name="speed"
            value={sheetData.speed}
            onChange={handleChange}
            className="border p-1 rounded w-full"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Size</label>
          <input
            type="text"
            name="size"
            value={sheetData.size}
            onChange={handleChange}
            className="border p-1 rounded w-full"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Passive Perception</label>
          <input
            type="text"
            name="passivePerception"
            value={sheetData.passivePerception}
            onChange={handleChange}
            className="border p-1 rounded w-full"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Hit Dice</label>
          <input
            type="text"
            name="hitDice"
            value={sheetData.hitDice}
            onChange={handleChange}
            className="border p-1 rounded w-full"
          />
        </div>
      </div>

      {/* Tools, Weapons, Armor, Training, Languages */}
      <h2 className="text-xl font-bold text-amber-400 mb-2">Equipment & Background</h2>
      <div className="grid grid-cols-2 gap-4 mb-4">
        <div>
          <label className="block text-sm font-medium text-amber-400">Tools</label>
          <input
            type="text"
            name="tools"
            value={sheetData.tools}
            onChange={handleChange}
            className="border p-1 rounded w-full"
            placeholder="List tools"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Weapons</label>
          <input
            type="text"
            name="weapons"
            value={sheetData.weapons}
            onChange={handleChange}
            className="border p-1 rounded w-full"
            placeholder="List weapons"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Armor Training</label>
          <input
            type="text"
            name="armorTraining"
            value={sheetData.armorTraining}
            onChange={handleChange}
            className="border p-1 rounded w-full"
            placeholder="Light, Medium, Heavy, etc."
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Background</label>
          <input
            type="text"
            name="background"
            value={sheetData.background}
            onChange={handleChange}
            className="border p-1 rounded w-full"
            placeholder="Your character's background"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Languages</label>
          <input
            type="text"
            name="languages"
            value={sheetData.languages}
            onChange={handleChange}
            className="border p-1 rounded w-full"
            placeholder="List languages"
          />
        </div>
      </div>

      {/* Skills */}
      <h2 className="text-xl font-bold text-amber-400 mb-2">Skills</h2>
      <div className="grid grid-cols-3 gap-4 mb-4">
        {[
          { label: "Animal Handling", name: "animalHandling" },
          { label: "Insight", name: "insight" },
          { label: "Medicine", name: "medicine" },
          { label: "Perception", name: "perception" },
          { label: "Survival", name: "survival" },
          { label: "Deception", name: "deception" },
          { label: "Intimidation", name: "intimidation" },
          { label: "Performance", name: "performance" },
          { label: "Persuasion", name: "persuasion" },
          { label: "Acrobatics", name: "acrobatics" },
          { label: "Sleight of Hand", name: "sleightOfHand" },
          { label: "Stealth", name: "stealth" },
          { label: "Athletics", name: "athletics" },
          { label: "Arcana", name: "arcana" },
          { label: "History", name: "history" },
          { label: "Investigation", name: "investigation" },
          { label: "Nature", name: "nature" },
          { label: "Religion", name: "religion" },
        ].map((skill) => (
          <div key={skill.name}>
            <label className="block text-sm font-medium text-amber-400">{skill.label}</label>
            <input
              type="text"
              name={skill.name}
              value={sheetData[skill.name]}
              onChange={handleChange}
              className="border p-1 rounded w-full"
            />
          </div>
        ))}
      </div>

      {/* Additional Info */}
      <h2 className="text-xl font-bold text-amber-400 mb-2">Additional Details</h2>
      <div className="grid grid-cols-2 gap-4 mb-4">
        <div>
          <label className="block text-sm font-medium text-amber-400">Class Level & Temp Spent</label>
          <input
            type="text"
            name="classLevel"
            value={sheetData.classLevel}
            onChange={handleChange}
            className="border p-1 rounded w-full"
            placeholder="e.g., Level 5, Temp: 3"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Shield</label>
          <input
            type="text"
            name="shield"
            value={sheetData.shield}
            onChange={handleChange}
            className="border p-1 rounded w-full"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Successes</label>
          <input
            type="text"
            name="successes"
            value={sheetData.successes}
            onChange={handleChange}
            className="border p-1 rounded w-full"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Equipment / Training & Proficiencies</label>
          <input
            type="text"
            name="equipment"
            value={sheetData.equipment}
            onChange={handleChange}
            className="border p-1 rounded w-full"
            placeholder="Comma separated list"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Feats</label>
          <input
            type="text"
            name="feats"
            value={sheetData.feats}
            onChange={handleChange}
            className="border p-1 rounded w-full"
            placeholder="Comma separated list"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Class Features & Weapons/Damage Cantrips</label>
          <input
            type="text"
            name="classFeatures"
            value={sheetData.classFeatures}
            onChange={handleChange}
            className="border p-1 rounded w-full"
            placeholder="Comma separated list"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Species Traits</label>
          <input
            type="text"
            name="speciesTraits"
            value={sheetData.speciesTraits}
            onChange={handleChange}
            className="border p-1 rounded w-full"
            placeholder="Comma separated list"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Shields (Light/Medium/Heavy)</label>
          <input
            type="text"
            name="shields"
            value={sheetData.shields}
            onChange={handleChange}
            className="border p-1 rounded w-full"
            placeholder="e.g., Light, Medium, Heavy"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Casting Time</label>
          <input
            type="text"
            name="castingTime"
            value={sheetData.castingTime}
            onChange={handleChange}
            className="border p-1 rounded w-full"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Concentration, Ritual & Required Material</label>
          <input
            type="text"
            name="concentrationRitual"
            value={sheetData.concentrationRitual}
            onChange={handleChange}
            className="border p-1 rounded w-full"
            placeholder="Details"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-amber-400">Currency (CP, SP, EP, GP, PP)</label>
          <input
            type="text"
            name="currency"
            value={sheetData.currency}
            onChange={handleChange}
            className="border p-1 rounded w-full"
            placeholder="e.g., 10 CP, 5 SP"
          />
        </div>
      </div>
    </div>
  );
}

/** ========== MAIN APP COMPONENT ========== */
function App() {
  return (
    <div className="min-h-screen p-4">
      {/* Top bar with dark mode, backup, restore */}
      <div className="flex flex-wrap items-center justify-between mb-4 gap-2">
        <DarkModeToggle />
        <div className="flex gap-2">
          <button className="px-3 py-1 btn-dnd rounded" onClick={backupLocalStorage}>
            Backup Local Storage
          </button>
          <label className="px-3 py-1 btn-dnd rounded cursor-pointer text-sm">
            Restore Data
            <input type="file" accept=".json" onChange={restoreLocalStorage} className="hidden" />
          </label>
        </div>
      </div>

      <CharacterSheet />
    </div>
  );
}

ReactDOM.render(<App />, document.getElementById("root"));
</script>
</body>
</html>
